<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>소식 게시글 상세</title>
    <style>
        #journal-details {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px; /* 내용 좌우 패딩 */
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            text-align: center; /* 이미지 가운데 정렬을 위한 속성 추가 */
        }
        #journal-details img {
            max-height: 300px; /* 이미지의 최대 높이를 300px로 제한 */
            width: auto; /* 높이에 맞춰 자동으로 너비를 조정 */
            margin-top: 20px;
        }
        #journal-details h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        #journal-details .posting-date {
            font-size: 14px; /* 게시일자 폰트 크기 */
            color: #777;    /* 게시일자 색상 */
            margin-bottom: 20px;
        }
        #journal-details h1,
        #journal-details .posting-date,
        #journal-details .content {
            text-align: left; /* 텍스트 왼쪽 정렬 */

        }
        #journal-details .content {
            margin-top: 20px;
            white-space: pre-line; /* 줄바꿈과 공백을 유지 */
        }

    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        var journalNo = [[${journal.journalNo}]]; // Thymeleaf 변수 값을 JavaScript 변수에 저장
        var userNo = [[${userNo} != null ? ${userNo} : 'null']]; // Thymeleaf 변수 값을 JavaScript 변수로 저장, userNo 값이 없을 경우 null으로 초기화
        console.log(typeof userNo);
        console.log('journalNo:', journalNo, 'userNo:', userNo); // 콘솔에 값 출력

        function toggleLike() {
            alert('Journal No: ' + journalNo + ', User No: ' + userNo);
            if (userNo === null) {
                alert('로그인이 필요합니다. 로그인 페이지로 이동합니다.');
                window.location.href = '/user/login'; // 로그인 페이지 URL로 리다이렉트
                return;
            }
            $.ajax({
                url: '/introduction/journal/like',
                type: 'POST',
                data: {journalNo: journalNo, userNo: userNo},
                success: function(response) {
                    $('#likeCount').text(response.likeCount);
                },
                error: function(xhr, status, error) {
                    console.error('좋아요 처리 중 오류가 발생했습니다:', status, error);
                    alert('좋아요 처리 중 오류가 발생했습니다.');
                }
            });
        }
    </script>
</head>
<body>

<div th:replace="~{common/menubar}"></div>
<div th:replace="~{introduction/inMenubar}"></div>

<div id="journal-details">
    <div th:if="${journal != null}">
        <h1 th:text="${journal.title}">제목</h1>
        <p class="posting-date" th:text="${#dates.format(journal.postingDate, 'yyyy-MM-dd')}">게시일시</p>


        <!-- 이미지 또는 기본 썸네일 표시 -->
        <div th:if="${#lists.size(journal.journalFiles) > 0}">
            <img th:each="file : ${journal.journalFiles}" th:if="${file.fileType.startsWith('image/')}" th:src="@{'/uploadFiles/' + ${file.fileName}}" alt="파일 이미지" />
        </div>
        <div th:unless="${#lists.size(journal.journalFiles) > 0}">
            <img src="/images/introduction/default-thumbnail.png" alt="기본 썸네일 이미지" />
        </div>



        <div class="content" th:text="${journal.content}">내용</div>

        <!-- 좋아요 기능 추가 -->
        <div>
            <button onclick="toggleLike()" class="btn btn-primary">좋아요 <span id="likeCount" th:text="${likeCount}">0</span></button>
            <span>/ Current Journal No: <span id="currentJournalNo" th:text="${journal.journalNo}">0</span></span>
            <span>/ Current User No: <span id="currentUserNo" th:text="${userNo}">0</span></span>
        </div>
    </div>
</div>
<div th:replace="common/footer.html"></div>
</body>
</html>
