<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ°ê²Œë” toonGather</title>
    <style>
        /* ì „ì²´ ìŠ¤íƒ€ì¼ */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            vertical-align: top;
        }

        th {
            background-color: #f2f2f2;
            width: 30%;
        }

        #webtoonOne {
            width: 80%;
            max-width: 60%;
            margin: auto;
        }

        #webtoonDetail {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: auto;
        }

        #webtoonThumbnail {
            width: 30%;
            text-align: center;
        }

        #webtoonThumbnail img {
            max-width: 100%;
            border-radius: 8px;
            height: auto;
        }
        /* ëŒ“ê¸€ ìŠ¤íƒ€ì¼ */
        #comments {
            margin-top: 20px;
            padding: 10px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #comments h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        .comment {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f2f2f2;
            border-radius: 8px;
        }
        .comment p {
            margin-bottom: 5px;
        }
        .comment .author {
            font-weight: bold;
            color: #333;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .comment-feedback {
            display: flex;
            gap: 10px;
        }
        .btn-like, .btn-dislike {
            border: 2px solid;
            padding: 4px 6px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, transform 0.3s;
            font-size: 16px;
            background-color: transparent;
            color: #333;
            display: flex;
            align-items: center;
        }
        .btn-like {
            border-color: #007bff;
        }
        .btn-like.selected, .btn-like:hover {
            background-color: #007bff;
            color: #fff;
        }
        .btn-dislike {
            border-color: #dc3545;
        }
        .btn-dislike.selected, .btn-dislike:hover {
            background-color: #dc3545;
            color: #fff;
        }
        .comment-content {
            margin-top: 10px;
        }
        .comments-footer {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 10px;
        }
        .comments-footer button {
            margin-left: 10px;
        }
        .btn-edit, .btn-delete {
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .btn-edit {
            background-color: #007bff;
            color: #fff;
        }
        .btn-edit:hover {
            background-color: #0056b3;
        }
        .btn-delete {
            background-color: #dc3545;
            color: #fff;
        }
        .btn-delete:hover {
            background-color: #c82333;
        }
        #social {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            flex-wrap: wrap;
        }
        #social button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-left: 10px;
        }
        #social button:hover {
            background-color: #0056b3;
        }
        .btn-star {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            color: gold;
            border: 2px solid gold;
            padding: 5px 10px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            text-align: center;
        }
        .btn-star:hover {
            background-color: gold;
            color: white;
        }
        .best-label {
            background-color: red;
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }
        .hidden {
            display: none !important;
        }.button-container {
    display: flex;
    justify-content: center; /* ë²„íŠ¼ì„ ê°€ìš´ë° ì •ë ¬ */
}

    </style>
</head>
<body>

<div th:replace="common/menubar.html"></div>
<div  th:replace="common/webtoon_menubar.html"></div>
<br>
<div id="webtoonOne">
<h1>ì›¹íˆ° ì •ë³´</h1>

<div id="webtoonDetail">
    <th:block th:if="${user.userNo > 0}">
        <form th:action="@{/webtoon/save/inset}" method="post">
            <input type="hidden"  name="webtoon_no" th:value="${one.webtoon_no}">
            <input type="hidden"  name="webtoon_id" th:value="${one.webtoon_id}">
            <input type="hidden"  name="webtoon_name" th:value="${one.webtoon_name}">


            <button th:if="${save == null}" type="submit" class="btn-star">â˜†</button>

        </form>
        <form th:action="@{/webtoon/save/delete}" method="post">
            <input th:if="${save != null}" type="hidden"  name="saveNo" th:value="${save.saveNo}">
            <input type="hidden"  name="webtoon_id" th:value="${one.webtoon_id}">
            <input type="hidden"  name="webtoon_name" th:value="${one.webtoon_name}">

           \
            <button th:if="${save != null}" type="submit" class="btn-star">â˜…</button>
        </form>
    </th:block>
    <div id="webtoon">
    <table>
        <tr>
            <td id="webtoonThumbnail" rowspan='11'></td>
            <th>ì œëª©</th>
            <td id="webtoonTitle"></td>

        </tr>
        <tr>
            <th>ì œê³µì</th>
            <td id="webtoonProvider"></td>
        </tr>
        <tr>
            <th>ë§í¬</th>
            <td id="webtoonLink"></td>
        </tr>
        <tr>
            <th>ì‘ê°€</th>
            <td id="webtoonAuthors"></td>
        </tr>
        <tr>
            <th>ì¥ë¥´</th>
            <td id="webtoonGenre" th:text="${one.genre}"></td>
        </tr>
        <tr>
            <th>íƒœê·¸</th>
            <td id="webtoonTags" th:text="${one.tags}"></td>
        </tr>
        <tr>
            <th>ì—°ì¬ ì—¬ë¶€</th>
            <td id="webtoonIsEnd"></td>
        </tr>
        <tr>
            <th>ë¬´ë£Œ ì—¬ë¶€</th>
            <td id="webtoonIsFree"></td>
        </tr>
        <tr>
            <th>ì—…ë°ì´íŠ¸ ì—¬ë¶€</th>
            <td id="webtoonIsUpdated"></td>
        </tr>
        <tr>
            <th>ì—°ë ¹ ë“±ê¸‰</th>
            <td id="webtoonAgeGrade"></td>
        </tr>
        <tr>
            <th>ë¬´ë£Œ ëŒ€ê¸° ì‹œê°„(ì‹œê°„)</th>
            <td id="webtoonFreeWaitHour"></td>
        </tr>

    </table>
</div>


    <div id="social"> <th:block th:if="${user.userNo > 0}">
        <!-- ë¦¬ë·° ì‘ì„± í¼ -->
        <form id="ReviewForm" th:action="@{/social/reviews/insert/{webtoonNo}(webtoonNo=${one.webtoon_no})}" method="get">
            <button id="reviewButton" type="submit" class="btn btn-primary">ë¦¬ë·° ë“±ë¡</button>
        </form>

        <form id="DiaryForm" th:action="@{/social/diaries/insert/{webtoonNo}(webtoonNo=${one.webtoon_no})}" method="get">



            <button type="submit" class="btn btn-primary">ë‹¤ì´ì–´ë¦¬ ë“±ë¡</button>
        </form>

    </th:block>
    </div>
</div>


    <div id="commentinto">
    <!-- ë¦¬ë·° ì‘ì„± í¼ -->
    <form id="commentForm" th:action="@{/webtoon/one/comment}" method="post">
        <div class="form-group">
            <label for="content">ëŒ“ê¸€</label>
            <textarea class="form-control" id="content" name="content" rows="5" required maxlength="200"></textarea>
            <!-- hidden í•„ë“œë¡œ ì›¹íˆ° ë²ˆí˜¸ ì „ì†¡ -->

            <input type="hidden" id="webtoonNo" name="webtoon_no" th:value="${one.webtoon_no}">
            <input type="hidden" id="webtoonId" name="webtoon_id" th:value="${one.webtoon_id}">
            <input type="hidden" id="webtoonName" name="webtoon_name" th:value="${one.webtoon_name}">



        </div>
        <th:block th:if="${user.userNo > 0}">
        <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ë“±ë¡</button>
        </th:block>
    </form>
    </div>

    <div id="comments">
        <h2>ëŒ“ê¸€ ëª©ë¡</h2>
        <div th:each="comment , iterStat: ${bestComments}" class="comment">
            <div class="comment-header">

                <p class="comment-author">
                    <span class="best-label">BEST<span th:text="${iterStat.index + 1}"></span></span>
                    ì‘ì„±ì: <span th:text="${comment.nickname}" class="author"></span>
                </p>
                <div class="comment-feedback">
                    <button class="btn-like"
                            th:data-comment-no="${comment.commentNo}"
                            th:classappend="${commentLikeMap[comment.commentNo] != null && commentLikeMap[comment.commentNo].getLikeCode() == 1 ? ' selected' : ''}"
                            data-initial-liked="${comment.liked}"
                            data-action="like">
                        ğŸ‘<span th:text="${comment.liked}"></span>
                    </button>
                    <button class="btn-dislike"
                            th:data-comment-no="${comment.commentNo}"
                            th:classappend="${commentLikeMap[comment.commentNo] != null && commentLikeMap[comment.commentNo].getLikeCode() == -1 ? ' selected' : ''}"
                            data-action="dislike">ğŸ‘
                        <span th:text="${comment.dislike}"></span></button>
                </div>
            </div>
            <!-- ëŒ“ê¸€ ë‚´ìš©ì„ ìˆ˜ì • ê°€ëŠ¥í•œ textareaë¡œ í‘œì‹œ -->
            <div class="comment-content">

                <textarea class="form-control comment-textarea" style="display: none;" rows="5" th:text="${comment.content}" required maxlength="200"></textarea>
                <p class="comment-text" th:text="${comment.content}"></p>
            </div>
            <div class="comments-footer">
                <th:block th:if="${user.userNo == comment.userNo}">
                    <button type="button" class="btn btn-primary btn-edit" th:data-comment-no="${comment.commentNo}">ìˆ˜ì •</button>
                    <form th:action="@{/webtoon/comment/delete}" method="post">
                        <input type="hidden" name="commentNo" th:value="${comment.commentNo}">
                        <input type="hidden" name="webtoon_name" th:value="${one.webtoon_name}">
                        <input type="hidden" name="webtoon_id" th:value="${one.webtoon_id}">
                        <button type="submit" class="btn btn-danger">ì‚­ì œ</button>
                    </form>
                </th:block>
            </div>
        </div>
        <div id="comments-container">
            <div th:each="comment, iterStat : ${comments}" class="comment" th:classappend="${iterStat.index >= 10 ? ' hidden' : ''}">
                <div class="comment-header">
                    <p class="comment-author">ì‘ì„±ì: <span th:text="${comment.nickname}" class="author"></span></p>
                    <div class="comment-feedback">
                        <button class="btn-like"
                                th:data-comment-no="${comment.commentNo}"
                                th:classappend="${commentLikeMap[comment.commentNo] != null && commentLikeMap[comment.commentNo].getLikeCode() == 1 ? ' selected' : ''}"
                                data-initial-liked="${comment.liked}"
                                data-action="like">
                            ğŸ‘<span th:text="${comment.liked}"></span>
                        </button>
                        <button class="btn-dislike"
                                th:data-comment-no="${comment.commentNo}"
                                th:classappend="${commentLikeMap[comment.commentNo] != null && commentLikeMap[comment.commentNo].getLikeCode() == -1 ? ' selected' : ''}"
                                data-action="dislike">ğŸ‘
                            <span th:text="${comment.dislike}"></span></button>
                    </div>
                </div>
                <!-- ëŒ“ê¸€ ë‚´ìš©ì„ ìˆ˜ì • ê°€ëŠ¥í•œ textareaë¡œ í‘œì‹œ -->
                <div class="comment-content">
                    <textarea class="form-control comment-textarea" style="display: none;" rows="5" th:text="${comment.content}" required maxlength="200"></textarea>
                    <p class="comment-text" th:text="${comment.content}"></p>

                </div>
                <div class="comments-footer">
                    <span class="author" th:if="${comment.createdAt == comment.updatedAt}">ì‘ì„±ì¼:
                       <span th:text="${#dates.format(comment.createdAt, 'yyyy-MM-dd')}"></span>
                     </span>
                    <span class="author" th:if="${comment.createdAt != comment.updatedAt}">ìˆ˜ì •ì¼:
                       <span th:text="${#dates.format(comment.updatedAt, 'yyyy-MM-dd')}"></span>
                     </span>
                    <th:block th:if="${user.userNo == comment.userNo}">
                        <button type="button" class="btn btn-primary btn-edit" th:data-comment-no="${comment.commentNo}">ìˆ˜ì •</button>
                        <form th:action="@{/webtoon/comment/delete}" method="post">
                            <input type="hidden" name="commentNo" th:value="${comment.commentNo}">
                            <input type="hidden" name="webtoon_name" th:value="${one.webtoon_name}">
                            <input type="hidden" name="webtoon_id" th:value="${one.webtoon_id}">
                            <button type="submit" class="btn btn-danger">ì‚­ì œ</button>
                        </form>
                    </th:block>
                </div>
            </div> <div class="button-container">
            <button id="load-more" class="btn btn-primary">ë”ë³´ê¸°</button>
        </div>
        </div>

    </div>
</div>
<div th:replace="common/footer.html"></div>

<script>



    document.addEventListener('DOMContentLoaded', function() {
    const loadMoreButton = document.getElementById('load-more');
    let currentLimit = 10;
    const comments = document.querySelectorAll('#comments-container .comment');
    const totalComments = comments.length;

    // ì´ˆê¸° ëŒ“ê¸€ í‘œì‹œ
    comments.forEach((comment, index) => {
        if (index < currentLimit) {
            comment.classList.remove('hidden');
        }
    });

    loadMoreButton.addEventListener('click', function() {
        currentLimit += 10;
        comments.forEach((comment, index) => {
            if (index < currentLimit) {
                comment.classList.remove('hidden');
            }
        });

        // Hide the button if all comments are shown
        if (currentLimit >= totalComments) {
            console.log('Hiding button');
            loadMoreButton.classList.add('hidden');
        }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë“  ëŒ“ê¸€ì´ ì´ë¯¸ ë¡œë“œëœ ê²½ìš° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
    if (currentLimit >= totalComments) {
        console.log('Hiding button on page load');
        loadMoreButton.classList.add('hidden');
    }



        const isLoggedAge=[[${isLoggedAge}]];
        const urlParams = new URLSearchParams(window.location.search);
        const id =  '[[${one.webtoon_id}]]';
        const no =  [[${one.webtoon_no}]];
        const title = '[[${one.webtoon_name}]]';
        const userNo = [[${user.userNo}]];
        const encodedStr = encodeURIComponent(title);

        // ì›¹íˆ° ì„¸ë¶€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ API URL
        const apiUrl = `https://korea-webtoon-api-cc7dda2f0d77.herokuapp.com/webtoons?keyword=${encodedStr}`;

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                if (data && data.webtoons && data.webtoons.length > 0) {
                    const webtoon = data.webtoons.find(webtoon => webtoon.id === id);
                    if (webtoon) {

                    if (webtoon.ageGrade> 18 && isLoggedAge<19) {
                        if(isLoggedAge>0){
                        alert("19ì„¸ ì´ìš©ê°€ ì…ë‹ˆë‹¤");
                        window.location.href = `/`;
                        }else{
                        alert("19ì„¸ ì´ìš©ê°€ ì…ë‹ˆë‹¤ ë¡œê·¸ì¸ì„ í•˜ì‹œì˜¤");
                        window.location.href = `/user/login`;
                        }
                        event.preventDefault(); // ê¸°ë³¸ ë™ì‘ ì¤‘ë‹¨

                    }


                        document.getElementById('webtoonTitle').textContent = webtoon.title;
                        document.getElementById('webtoonProvider').textContent = webtoon.provider;

                        const linkElement = document.createElement('a');
                        linkElement.href = webtoon.url;
                        linkElement.textContent = "ì›¹íˆ°ìœ¼ë¡œ ì´ë™";
                        linkElement.addEventListener('click', function(event) {
                            event.preventDefault();
                            // í´ë¦­ ì‹œ ì„œë²„ì— count ì¦ê°€ ìš”ì²­
                            fetch(`/webtoon/one/count?webtoon_no=${no}`, {
                                method: 'GET'
                            }).then(response => {
                                if (response.ok) {
                                    console.log('count ì¦ê°€ ì„±ê³µ');
                                    window.location.href = webtoon.url;
                                } else {
                                    console.error('count ì¦ê°€ ì‹¤íŒ¨');
                                }
                            }).catch(error => {
                                console.error('ì—ëŸ¬ ë°œìƒ:', error);
                            });
                        });
                        document.getElementById('webtoonLink').appendChild(linkElement);

                        const thumbnailElement = document.createElement('img');
                        thumbnailElement.src = webtoon.thumbnail[0];
                        thumbnailElement.alt = `${webtoon.title} ì¸ë„¤ì¼`;
                        document.getElementById('webtoonThumbnail').appendChild(thumbnailElement);

                        document.getElementById('webtoonAuthors').textContent = webtoon.authors.join(', ');
                        document.getElementById('webtoonIsEnd').textContent = webtoon.isEnd ? 'ì¢…ê²°' : 'ì—°ì¬ ì¤‘';
                        document.getElementById('webtoonIsFree').textContent = webtoon.isFree ? 'ë¬´ë£Œ' : 'ìœ ë£Œ';
                        document.getElementById('webtoonIsUpdated').textContent = webtoon.isUpdated ? 'ì—…ë°ì´íŠ¸ ë¨' : 'ì—…ë°ì´íŠ¸ ì•ˆ ë¨';
                        document.getElementById('webtoonAgeGrade').textContent = webtoon.ageGrade;
                        document.getElementById('webtoonFreeWaitHour').textContent = webtoon.freeWaitHour;

                        // ë²„íŠ¼ì˜ í‘œì‹œ ì—¬ë¶€ë¥¼ webtoon.isEndì— ë”°ë¼ ê²°ì •
                        const reviewButton = document.getElementById('reviewButton');
                        if (!webtoon.isEnd&&userNo > 0) {
                             reviewButton.style.display = 'none';
                        }



                    } else {
                        console.error('í•´ë‹¹ IDì˜ ì›¹íˆ°ì´ ë°ì´í„°ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } else {
                    console.error('ì›¹íˆ° ì„¸ë¶€ ì •ë³´ê°€ ì—†ê±°ë‚˜ APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('ì›¹íˆ° ì„¸ë¶€ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
            });

        const userNoInput = document.getElementById('userNo');
        const contentTextarea = document.getElementById('content');

        // userNo ê°’ ì½ê¸°


        // userNoê°€ 1 ì´í•˜ì¸ ê²½ìš° textareaë¥¼ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì„¤ì •
        if (userNo <= 0) {
            contentTextarea.setAttribute('readonly', true);
        }



        const editButtons = document.querySelectorAll('.btn-edit');
        editButtons.forEach(button => {
        button.addEventListener('click', function handleEditButtonClick() {
            const commentDiv = button.closest('.comment');
            const commentText = commentDiv.querySelector('.comment-text');
            const commentTextarea = commentDiv.querySelector('.comment-textarea');
            const commentNoInput = commentDiv.querySelector('.commentNoInput');

            // ì´ì „ì— ì¶”ê°€ëœ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
            button.removeEventListener('click', handleEditButtonClick);

            // ëŒ“ê¸€ ë‚´ìš©ì„ ìˆ˜ì • ê°€ëŠ¥í•œ textareaë¡œ ì „í™˜
            commentTextarea.style.display = 'block';
            commentText.style.display = 'none';

            // ìˆ˜ì •í•  ëŒ“ê¸€ì˜ ë‚´ìš©ì„ textareaì— ì„¤ì •
            commentTextarea.value = commentText.textContent.trim();

            // ìˆ˜ì •í•  ëŒ“ê¸€ì˜ commentNo ê°’ì„ ê°€ì ¸ì˜´
            const commentNo = button.getAttribute('data-comment-no');

            // ìˆ˜ì • ë²„íŠ¼ì„ 'ì €ì¥'ìœ¼ë¡œ ë³€ê²½
            button.textContent = 'ì €ì¥';


            // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ì²˜ë¦¬í•  í•¨ìˆ˜
            const handleEditSave = function() {
                const editedContent = commentTextarea.value;
                if(commentTextarea.value.length>0){
                fetch(`/webtoon/one/update`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content: editedContent,
                        commentNo: commentNo // ìˆ˜ì •í•  ëŒ“ê¸€ì˜ commentNo ì „ì†¡
                    })
                }).then(response => {
                    if (response.ok) {
                        console.log('ëŒ“ê¸€ ìˆ˜ì • ì„±ê³µ');
                        // ì›í•˜ëŠ” ì‘ì—… ìˆ˜í–‰ (ì˜ˆ: ëŒ“ê¸€ ëª©ë¡ ì—…ë°ì´íŠ¸)
                    } else {
                        console.error('ëŒ“ê¸€ ìˆ˜ì • ì‹¤íŒ¨');
                    }
                }).catch(error => {
                    console.error('ì—ëŸ¬ ë°œìƒ:', error);
                });

                // 'ì €ì¥' ë²„íŠ¼ì„ ë‹¤ì‹œ 'ìˆ˜ì •'ìœ¼ë¡œ ë³€ê²½
                button.textContent = 'ìˆ˜ì •';

                // textareaë¥¼ ìˆ¨ê¸°ê³  ìˆ˜ì •ëœ ëŒ“ê¸€ ë‚´ìš©ì„ í‘œì‹œ
                commentTextarea.style.display = 'none';
                commentText.textContent = editedContent;
                commentText.style.display = 'block';

                // ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ë‹¤ì‹œ handleEditButtonClick í•¨ìˆ˜ ì‹¤í–‰
                button.addEventListener('click', handleEditButtonClick);
                  }
            };
            // 'ì €ì¥' ë²„íŠ¼ í´ë¦­ ì‹œ handleEditSave í•¨ìˆ˜ ì‹¤í–‰
            button.addEventListener('click', handleEditSave);

        });
    });


    const likeButtons = document.querySelectorAll('.btn-like');
    const dislikeButtons = document.querySelectorAll('.btn-dislike');
   function isDislikeSelected(commentNo) {
        return Array.from(dislikeButtons).some(button =>
            button.getAttribute('data-comment-no') === commentNo &&
            button.classList.contains('selected')
        );
    }
    likeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const commentNo = button.getAttribute('data-comment-no');
            const isSelected = button.classList.contains('selected');

            if (isDislikeSelected(commentNo)) {
                // ì‹«ì–´ìš” ë²„íŠ¼ì´ ì„ íƒëœ ìƒíƒœì¼ ë•Œ ì¢‹ì•„ìš” í´ë¦­ ë°©ì§€
                alert('ì‹«ì–´ìš”ê°€ ì„ íƒëœ ìƒíƒœì—ì„œëŠ” ì¢‹ì•„ìš”ë¥¼ í´ë¦­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì„œë²„ì— AJAX ìš”ì²­ ë³´ë‚´ê¸°
            fetch(`/webtoon/one/like`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ commentNo,isSelected })
            }).then(response => {
                // ì„œë²„ ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('ì„œë²„ ì˜¤ë¥˜');
                }
            }).then(data => {
                if (data.success) {
                    // ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ëœ ê²½ìš° UI ì—…ë°ì´íŠ¸
                    button.classList.toggle('selected'); // 'selected' í´ë˜ìŠ¤ í† ê¸€
                    const likeCountSpan = button.querySelector('span');
                    const newLikeCount = data.newLikeCount;
                    const currentLikeCount = parseInt(likeCountSpan.textContent, 10) || parseInt(button.getAttribute('data-initial-liked'), 10) || 0;
                    console.log(currentLikeCount)
                    likeCountSpan.textContent = currentLikeCount + newLikeCount;
                } else {
                    console.error('ì¢‹ì•„ìš” ì²˜ë¦¬ ì‹¤íŒ¨');
                }
            }).catch(error => {
                console.error('ì—ëŸ¬ ë°œìƒ:', error);
            });
        });
    });


    function isLikeSelected(commentNo) {
        return Array.from(likeButtons).some(button =>
            button.getAttribute('data-comment-no') === commentNo &&
            button.classList.contains('selected')
        );
    }

    dislikeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const commentNo = button.getAttribute('data-comment-no');
            const isSelected = button.classList.contains('selected');

            if (isLikeSelected(commentNo)) {
                // ì‹«ì–´ìš” ë²„íŠ¼ì´ ì„ íƒëœ ìƒíƒœì¼ ë•Œ ì¢‹ì•„ìš” í´ë¦­ ë°©ì§€
                alert('ì¢‹ì•„ìš”ê°€ ì„ íƒëœ ìƒíƒœì—ì„œëŠ” ì‹«ì–´ìš”ë¥¼ í´ë¦­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì„œë²„ì— AJAX ìš”ì²­ ë³´ë‚´ê¸°
            fetch(`/webtoon/one/dislike`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ commentNo,isSelected })
            }).then(response => {
                // ì„œë²„ ì‘ë‹µì´ JSONì¸ì§€ í™•ì¸
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('ì„œë²„ ì˜¤ë¥˜');
                }
            }).then(data => {
                if (data.success) {
                    // ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ëœ ê²½ìš° UI ì—…ë°ì´íŠ¸
                    button.classList.toggle('selected'); // 'selected' í´ë˜ìŠ¤ í† ê¸€
                    const likeCountSpan = button.querySelector('span');
                    const newLikeCount = data.newLikeCount;
                    const currentLikeCount = parseInt(likeCountSpan.textContent, 10) || parseInt(button.getAttribute('data-initial-liked'), 10) || 0;
                    console.log(currentLikeCount)
                    likeCountSpan.textContent = currentLikeCount + newLikeCount;
                } else {
                    console.error('ì¢‹ì•„ìš” ì²˜ë¦¬ ì‹¤íŒ¨');
                }
            }).catch(error => {
                console.error('ì—ëŸ¬ ë°œìƒ:', error);
            });
        });
    });


    });
</script>

</body>
</html>